<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ตู้หมุนไข่ (เวอร์ชั่นไข่ดิ้นได้)</title>
    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #FFDEE9;
            background-image: linear-gradient(0deg, #FFDEE9 0%, #B5FFFC 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        h2 { color: #555; text-shadow: 1px 1px 2px white; }

        .machine-container {
            position: relative;
            width: 280px;
            height: 420px;
        }

        .glass-dome {
            width: 240px;
            height: 200px;
            background-color: rgba(255, 255, 255, 0.6);
            border: 8px solid #FF6B6B;
            border-bottom: none;
            border-radius: 120px 120px 0 0;
            margin: 0 auto;
            position: relative;
            overflow: hidden;
            z-index: 2;
            box-shadow: inset 10px 10px 30px rgba(255,255,255,0.8), 0 0 10px rgba(0,0,0,0.1);
        }

        .ball-inside {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid rgba(0,0,0,0.1);
            transition: transform 0.2s; /* ช่วยให้การเคลื่อนที่ดูลื่นขึ้น */
        }

        .base {
            width: 280px;
            height: 200px;
            background-color: #FF6B6B;
            border-radius: 20px;
            position: relative;
            top: -5px;
            z-index: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .knob-area {
            background-color: white;
            width: 180px;
            height: 80px;
            margin-top: 20px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.2);
        }

        .knob {
            width: 60px;
            height: 60px;
            background-color: #eee;
            border-radius: 50%;
            border: 4px solid #ddd;
            position: relative;
            cursor: pointer;
            box-shadow: 0 4px 0 #bbb;
            transition: transform 0.1s;
        }
        
        .knob::after {
            content: '';
            position: absolute;
            top: 50%; left: 0; right: 0;
            height: 10px;
            background-color: #ddd;
            transform: translateY(-50%);
        }

        .knob:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #bbb;
        }

        .exit-hole {
            width: 100px;
            height: 60px;
            background-color: #333;
            margin-top: 20px;
            border-radius: 10px 10px 40px 40px;
            position: relative;
            overflow: hidden;
        }

        .prize-capsule {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #fff, #FFD700);
            border: 2px solid rgba(0,0,0,0.1);
            position: absolute;
            top: 260px; 
            left: 50%;
            transform: translateX(-50%) scale(0);
            z-index: 10;
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 100;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            animation: popIn 0.3s ease-out;
            max-width: 80%;
        }

        button.close-btn {
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #FF6B6B;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
        }

        /* Animations */
        @keyframes spinKnob {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes popIn {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        /* Animation ไข่ดิ้น */
        @keyframes tumble {
            0% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(10px, -20px) rotate(90deg); }
            50% { transform: translate(-15px, 10px) rotate(180deg); }
            75% { transform: translate(15px, -10px) rotate(270deg); }
            100% { transform: translate(0, 0) rotate(360deg); }
        }

        .dropping { 
            animation: dropBall 0.6s forwards; 
        }

        @keyframes dropBall {
            0% { top: 260px; transform: translateX(-50%) scale(0.5); opacity: 0; }
            50% { opacity: 1; }
            100% { top: 380px; transform: translateX(-50%) scale(1); }
        }

        /* Class สำหรับสั่งไข่ดิ้น */
        .mixing {
            animation: tumble 0.4s infinite linear;
        }
        
        /* สั่งหมุน */
        .spinning { animation: spinKnob 0.5s linear; }

    </style>
</head>
<body>

    <h2>ตู้เสี่ยงเวร (กรรม)</h2>

    <div class="machine-container" id="machine">
        <div class="glass-dome">
            <div class="ball-inside" style="background:#FF9A9E; top:120px; left:40px;"></div>
            <div class="ball-inside" style="background:#A18CD1; top:140px; left:100px;"></div>
            <div class="ball-inside" style="background:#FBC2EB; top:110px; left:150px;"></div>
            <div class="ball-inside" style="background:#84FAB0; top:150px; left:70px;"></div>
            <div class="ball-inside" style="background:#FFD1FF; top:90px; left:90px;"></div>
            <div class="ball-inside" style="background:#FFE066; top:130px; left:30px;"></div>
        </div>
        
        <div class="base">
            <div class="knob-area">
                <div class="knob" id="knob" onclick="playGacha()"></div>
            </div>
            <div class="exit-hole"></div>
        </div>

        <div class="prize-capsule" id="capsule">?</div>
    </div>

    <div class="modal" id="resultModal">
        <div class="modal-content">
            <h3 style="color:#FF6B6B">ยินดีด้วย!</h3>
            <div id="prizeText" style="font-size: 20px; margin: 20px 0;">...</div>
            <button class="close-btn" onclick="closeModal()">เล่นอีกครั้ง</button>
        </div>
    </div>

    <script>
        const prizes = [
            "BIRD",
            "LOOKWHA",
            "MAY",
            "PUI",
        ];

        let isPlaying = false;

        function playGacha() {
            if (isPlaying) return;
            isPlaying = true;

            const knob = document.getElementById('knob');
            const capsule = document.getElementById('capsule');
            // เลือกไข่ทั้งหมดข้างใน
            const balls = document.querySelectorAll('.ball-inside');

            // Reset ไข่ผลลัพธ์
            capsule.classList.remove('dropping');
            void capsule.offsetWidth;

            // 1. หมุนลูกบิด
            knob.classList.add('spinning');

            // 2. สั่งให้ไข่ข้างในดิ้น (ใส่ class mixing)
            balls.forEach((ball, index) => {
                // เพิ่ม delay เล็กน้อยให้แต่ละลูกขยับไม่พร้อมกันเป๊ะๆ จะได้ดูธรรมชาติ
                ball.style.animationDelay = (index * 0.1) + 's'; 
                ball.classList.add('mixing');
            });

            // 3. หน่วงเวลา 5 วินาที
            setTimeout(() => {
                // หยุดหมุนลูกบิด
                knob.classList.remove('spinning');
                
                // หยุดไข่ดิ้น
                balls.forEach(ball => {
                    ball.classList.remove('mixing');
                    ball.style.transform = "translate(0,0)"; // Reset ตำแหน่ง
                });

                // สุ่มสีไข่ผลลัพธ์
                const colors = ['#FF9A9E', '#A18CD1', '#FBC2EB', '#84FAB0', '#FFD700'];
                const randomColor = colors[Math.floor(Math.random() * colors.length)];
                capsule.style.background = `radial-gradient(circle at 30% 30%, #fff, ${randomColor})`;
                
                // ไข่ตกลงมา
                capsule.classList.add('dropping');

                // รอไข่ตกถึงพื้นแล้วค่อยโชว์ผล
                setTimeout(() => {
                    showResult();
                }, 700);

            }, 5000); // 5000 milliseconds = 5 วินาที
        }

        function showResult() {
            const modal = document.getElementById('resultModal');
            const prizeText = document.getElementById('prizeText');
            
            const randomPrize = prizes[Math.floor(Math.random() * prizes.length)];
            prizeText.innerText = `(ผู้โชคดี): ${randomPrize}`;
            
            modal.style.display = 'flex';
        }

        function closeModal() {
            const modal = document.getElementById('resultModal');
            const capsule = document.getElementById('capsule');
            
            modal.style.display = 'none';
            capsule.classList.remove('dropping');
            isPlaying = false;
        }
    </script>
</body>
</html>