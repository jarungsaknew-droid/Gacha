<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gacha Machine - Clean Version</title>
    <style>
        :root {
            --bg-gradient: linear-gradient(0deg, #FFDEE9 0%, #B5FFFC 100%);
            --machine-color: #FF6B6B;
            --machine-shadow: rgba(0,0,0,0.2);
            --glass-border: rgba(255, 255, 255, 0.6);
        }

        body {
            font-family: 'Sarabun', sans-serif;
            background-image: var(--bg-gradient);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        h2 {
            color: #555;
            text-shadow: 2px 2px 0px rgba(255,255,255,0.5);
            margin-bottom: 20px;
        }

        /* --- Machine Structure --- */
        .machine-container {
            position: relative;
            width: 280px;
            height: 440px; /* เพิ่มความสูงนิดหน่อย */
        }

        .glass-dome {
            width: 240px;
            height: 200px;
            background-color: rgba(255, 255, 255, 0.4);
            border: 8px solid var(--machine-color);
            border-bottom: none;
            border-radius: 120px 120px 0 0;
            margin: 0 auto;
            position: relative;
            overflow: hidden;
            z-index: 2;
            box-shadow: inset 10px 10px 30px rgba(255,255,255,0.8), 0 5px 15px rgba(0,0,0,0.1);
        }

        .base {
            width: 280px;
            height: 220px;
            background-color: var(--machine-color);
            border-radius: 20px 20px 30px 30px;
            position: relative;
            top: -5px;
            z-index: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 15px 25px var(--machine-shadow);
        }

        /* --- Components --- */
        .ball-inside {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid rgba(0,0,0,0.1);
            box-shadow: inset -5px -5px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .knob-area {
            background-color: #fff;
            width: 180px;
            height: 90px;
            margin-top: 25px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: inset 0 3px 8px rgba(0,0,0,0.15);
        }

        .knob {
            width: 70px;
            height: 70px;
            background-color: #eee;
            border-radius: 50%;
            border: 5px solid #ddd;
            position: relative;
            cursor: pointer;
            box-shadow: 0 5px 0 #bbb;
            transition: transform 0.1s, box-shadow 0.1s;
        }
        
        .knob::after {
            content: '';
            position: absolute;
            top: 50%; left: 10%; right: 10%;
            height: 12px;
            background-color: #ccc;
            transform: translateY(-50%);
            border-radius: 5px;
        }

        .knob:active {
            transform: translateY(4px);
            box-shadow: 0 1px 0 #bbb;
        }

        .exit-hole {
            width: 120px;
            height: 70px;
            background-color: #333;
            margin-top: 25px;
            border-radius: 10px 10px 50px 50px;
            box-shadow: inset 0 5px 10px rgba(0,0,0,0.5);
            overflow: hidden;
            position: relative;
        }

        /* --- Prize Capsule --- */
        .prize-capsule {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #fff, #FFD700);
            border: 2px solid rgba(0,0,0,0.1);
            position: absolute;
            top: 280px; 
            left: 50%;
            transform: translateX(-50%) scale(0);
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: rgba(0,0,0,0.5);
            cursor: pointer;
        }

        /* --- Animations Classes --- */
        .mixing {
            animation: tumble 0.5s infinite linear alternate;
        }
        
        .spinning { 
            animation: spinKnob 0.8s linear infinite; 
        }

        .dropping { 
            animation: dropBall 0.8s cubic-bezier(0.5, -0.5, 0.2, 1.5) forwards; 
        }

        /* Keyframes */
        @keyframes spinKnob {
            100% { transform: rotate(360deg); }
        }

        @keyframes tumble {
            0% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(15px, -25px) rotate(90deg); }
            50% { transform: translate(-20px, 10px) rotate(180deg); }
            75% { transform: translate(20px, -15px) rotate(270deg); }
            100% { transform: translate(-5px, 5px) rotate(360deg); }
        }

        @keyframes dropBall {
            0% { top: 220px; opacity: 0; transform: translateX(-50%) scale(0.5); }
            60% { top: 390px; opacity: 1; transform: translateX(-50%) scale(1.1); }
            80% { top: 380px; transform: translateX(-50%) scale(1); }
            100% { top: 385px; transform: translateX(-50%) scale(1); }
        }

        /* --- Modal --- */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.6);
            z-index: 100;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(2px);
        }

        .modal-content {
            background-color: white;
            padding: 40px;
            border-radius: 25px;
            text-align: center;
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            max-width: 80%;
        }

        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        button.close-btn {
            margin-top: 25px;
            padding: 12px 30px;
            background-color: var(--machine-color);
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-size: 16px;
            transition: transform 0.1s;
        }
        button.close-btn:hover { transform: scale(1.05); }
    </style>
</head>
<body>

    <h2>ตู้เสี่ยงเวร (กรรม)</h2>

    <div class="machine-container">
        <div class="glass-dome" id="dome"></div>
        
        <div class="base">
            <div class="knob-area">
                <div class="knob" id="knob" onclick="startMachine()"></div>
            </div>
            <div class="exit-hole"></div>
        </div>

        <div class="prize-capsule" id="capsule">?</div>
    </div>

    <div class="modal" id="resultModal">
        <div class="modal-content">
            <h3 style="color:#FF6B6B; margin-top:0;">ผู้โชคดีคือ...</h3>
            <h1 id="prizeText" style="font-size: 32px; color:#333; margin: 20px 0;">...</h1>
            <button class="close-btn" onclick="resetMachine()">เล่นอีกครั้ง</button>
        </div>
    </div>

    <script>
        // --- Configuration ---
        const CONFIG = {
            prizes: ["BIRD", "LOOKWHA", "MAY", "PUI"], // รายชื่อรางวัล
            ballColors: ['#FF9A9E', '#A18CD1', '#FBC2EB', '#84FAB0', '#FFD1FF', '#FFE066'], // สีลูกบอล
            ballCount: 7, // จำนวนลูกบอลในตู้
            spinDuration: 5000 // ระยะเวลาหมุน (มิลลิวินาที)
        };

        // --- Elements ---
        const el = {
            dome: document.getElementById('dome'),
            knob: document.getElementById('knob'),
            capsule: document.getElementById('capsule'),
            modal: document.getElementById('resultModal'),
            prizeText: document.getElementById('prizeText')
        };

        let isPlaying = false;

        // --- Functions ---

        // 1. สร้างลูกบอลตอนโหลดหน้าเว็บ
        function initBalls() {
            el.dome.innerHTML = ''; // เคลียร์ของเก่า
            for (let i = 0; i < CONFIG.ballCount; i++) {
                const ball = document.createElement('div');
                ball.classList.add('ball-inside');
                
                // สุ่มสี
                ball.style.background = CONFIG.ballColors[i % CONFIG.ballColors.length];
                
                // สุ่มตำแหน่งเริ่มต้น
                const top = Math.random() * 100 + 60; // 60px - 160px
                const left = Math.random() * 160 + 20; // 20px - 180px
                ball.style.top = `${top}px`;
                ball.style.left = `${left}px`;
                
                el.dome.appendChild(ball);
            }
        }

        // 2. เริ่มทำงานเมื่อกดปุ่ม
        function startMachine() {
            if (isPlaying) return;
            isPlaying = true;

            // Reset Capsule
            el.capsule.classList.remove('dropping');
            el.capsule.style.transform = 'translateX(-50%) scale(0)';

            // Start Animation
            el.knob.classList.add('spinning');
            
            const balls = document.querySelectorAll('.ball-inside');
            balls.forEach(ball => {
                ball.style.animationDelay = Math.random() * 0.5 + 's'; // random delay ให้ดูธรรมชาติ
                ball.classList.add('mixing');
            });

            // รอ 5 วินาที
            setTimeout(() => {
                stopAnimation(balls);
                dropPrize();
            }, CONFIG.spinDuration);
        }

        // 3. หยุดอนิเมชั่น
        function stopAnimation(balls) {
            el.knob.classList.remove('spinning');
            balls.forEach(ball => {
                ball.classList.remove('mixing');
                // รีเซ็ตตำแหน่งให้นิ่งๆ
                ball.style.transform = 'translate(0,0)';
            });
        }

        // 4. ปล่อยรางวัล
        function dropPrize() {
            // สุ่มสีแคปซูลผลลัพธ์
            const randomColor = CONFIG.ballColors[Math.floor(Math.random() * CONFIG.ballColors.length)];
            el.capsule.style.background = `radial-gradient(circle at 30% 30%, #fff, ${randomColor})`;
            
            // Animation ตก
            el.capsule.classList.add('dropping');

            // แสดงผล
            setTimeout(() => {
                showResult();
            }, 1000);
        }

        // 5. แสดง Pop-up
        function showResult() {
            const result = CONFIG.prizes[Math.floor(Math.random() * CONFIG.prizes.length)];
            el.prizeText.innerText = result;
            el.modal.style.display = 'flex';
        }

        // 6. รีเซ็ตเพื่อเล่นใหม่
        function resetMachine() {
            el.modal.style.display = 'none';
            isPlaying = false;
        }

        // Run Init
        window.onload = initBalls;

    </script>
</body>
</html>
